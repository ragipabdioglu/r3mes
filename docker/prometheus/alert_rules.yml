groups:
  - name: r3mes_backend
    interval: 30s
    rules:
      - alert: BackendDown
        expr: up{job="r3mes-backend"} == 0
        for: 1m
        labels:
          severity: critical
          service: backend
        annotations:
          summary: "R3MES Backend is down"
          description: "R3MES backend service has been down for more than 1 minute."

      - alert: BackendHighErrorRate
        expr: rate(api_requests_total{status_code=~"5.."}[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          service: backend
        annotations:
          summary: "High error rate on R3MES backend"
          description: "Error rate is {{ $value }} errors per second (threshold: 0.1)"

      - alert: BackendHighLatency
        expr: histogram_quantile(0.95, api_request_duration_seconds_bucket) > 2
        for: 5m
        labels:
          severity: warning
          service: backend
        annotations:
          summary: "High latency on R3MES backend"
          description: "P95 latency is {{ $value }}s (threshold: 2s)"

      - alert: BackendLowCacheHitRate
        expr: rate(cache_hits_total[5m]) / (rate(cache_hits_total[5m]) + rate(cache_misses_total[5m])) < 0.5
        for: 10m
        labels:
          severity: warning
          service: backend
        annotations:
          summary: "Low cache hit rate on R3MES backend"
          description: "Cache hit rate is {{ $value | humanizePercentage }} (threshold: 50%)"

  - name: r3mes_blockchain
    interval: 30s
    rules:
      - alert: BlockchainNodeDown
        expr: up{job="r3mes-blockchain"} == 0
        for: 2m
        labels:
          severity: critical
          service: blockchain
        annotations:
          summary: "R3MES Blockchain node is down"
          description: "R3MES blockchain node has been down for more than 2 minutes."

      - alert: BlockchainSyncLag
        expr: (blockchain_latest_height - blockchain_current_height) > 100
        for: 5m
        labels:
          severity: warning
          service: blockchain
        annotations:
          summary: "Blockchain sync lag detected"
          description: "Node is {{ $value }} blocks behind (threshold: 100 blocks)"

      - alert: BlockchainNoNewBlocks
        expr: time() - blockchain_last_block_time > 60
        for: 2m
        labels:
          severity: critical
          service: blockchain
        annotations:
          summary: "No new blocks produced"
          description: "No new blocks have been produced for {{ $value }} seconds"

  - name: r3mes_miner
    interval: 30s
    rules:
      - alert: MinerDown
        expr: up{job="r3mes-miner"} == 0
        for: 5m
        labels:
          severity: warning
          service: miner
        annotations:
          summary: "R3MES Miner is down"
          description: "R3MES miner has been down for more than 5 minutes."

      - alert: MinerLowHashrate
        expr: miner_hashrate < 100
        for: 10m
        labels:
          severity: warning
          service: miner
        annotations:
          summary: "Low miner hashrate"
          description: "Miner hashrate is {{ $value }} (threshold: 100)"

      - alert: MinerHighGPUUsage
        expr: gpu_utilization_percent > 95
        for: 5m
        labels:
          severity: warning
          service: miner
        annotations:
          summary: "High GPU usage"
          description: "GPU utilization is {{ $value }}% (threshold: 95%)"

  - name: r3mes_system
    interval: 30s
    rules:
      - alert: HighMemoryUsage
        expr: system_memory_usage_bytes / system_memory_total_bytes > 0.9
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "High memory usage"
          description: "Memory usage is {{ $value | humanizePercentage }} (threshold: 90%)"

      - alert: HighCPUUsage
        expr: system_cpu_usage_percent > 90
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "High CPU usage"
          description: "CPU usage is {{ $value }}% (threshold: 90%)"

      - alert: LowDiskSpace
        expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) < 0.1
        for: 5m
        labels:
          severity: warning
          service: system
        annotations:
          summary: "Low disk space"
          description: "Disk space is {{ $value | humanizePercentage }} available (threshold: 10%)"

  - name: r3mes_network
    interval: 30s
    rules:
      - alert: LowMinerCount
        expr: network_active_miners < 10
        for: 10m
        labels:
          severity: warning
          service: network
        annotations:
          summary: "Low active miner count"
          description: "Only {{ $value }} active miners (threshold: 10)"

      - alert: NetworkHighLatency
        expr: network_avg_latency_ms > 1000
        for: 5m
        labels:
          severity: warning
          service: network
        annotations:
          summary: "High network latency"
          description: "Average network latency is {{ $value }}ms (threshold: 1000ms)"

