# R3MES Log Rotation Configuration
# Install: sudo cp scripts/logrotate/r3mes /etc/logrotate.d/r3mes

# R3MES Node Logs
/var/log/r3mes/node/*.log
/opt/r3mes/logs/node/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    sharedscripts
    postrotate
        systemctl reload remesd 2>/dev/null || true
    endscript
}

# R3MES Miner Logs
/var/log/r3mes/miner/*.log
/opt/r3mes/logs/miner/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    maxsize 100M
    sharedscripts
    postrotate
        systemctl reload r3mes-miner 2>/dev/null || true
    endscript
}

# R3MES Backend Logs
/var/log/r3mes/backend/*.log
/opt/r3mes/logs/backend/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    maxsize 200M
    sharedscripts
    postrotate
        # Send SIGUSR1 to uvicorn for log rotation
        pkill -USR1 -f "uvicorn.*r3mes" 2>/dev/null || true
    endscript
}

# R3MES Frontend Logs
/var/log/r3mes/frontend/*.log
/opt/r3mes/logs/frontend/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    maxsize 50M
}

# R3MES IPFS Logs
/var/log/r3mes/ipfs/*.log
/opt/r3mes/logs/ipfs/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    maxsize 500M
}

# R3MES Training Logs (can be large)
/var/log/r3mes/training/*.log
/opt/r3mes/logs/training/*.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    maxsize 1G
    dateext
    dateformat -%Y%m%d
}

# R3MES Audit Logs (keep longer for compliance)
/var/log/r3mes/audit/*.log
/opt/r3mes/logs/audit/*.log {
    weekly
    rotate 52
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    dateext
    dateformat -%Y%m%d
}

# R3MES Error Logs
/var/log/r3mes/error/*.log
/opt/r3mes/logs/error/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 r3mes r3mes
    maxsize 100M
}
